import{j as e,r as o,R as k,a as O}from"./vendor-react-D_7EDXj9.js";import{S as F,C as T,P as H,W as q,A as W,D as $,O as G,G as V,a as U,B as Y,V as z}from"./vendor-three-Dq0513u4.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&c(n)}).observe(document,{childList:!0,subtree:!0});function h(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(s){if(s.ep)return;s.ep=!0;const t=h(s);fetch(s.href,t)}})();function w(){return e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-container",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{className:"header-title",children:"Sistema de Monitoreo - Conductores de Bagazo"}),e.jsx("p",{className:"header-subtitle",children:"Sistema de Monitoreo - Conductores de Bagazo"})]}),e.jsx("div",{className:"header-info",children:e.jsx("span",{className:"badge",children:"IRISA S.A.S."})})]})})}function _(){const r=o.useRef(null),l=o.useRef(null),h=o.useRef(null),c=o.useRef(null),s=o.useRef(null),t=o.useRef(null),n=o.useRef(null),f=o.useRef(null);return o.useEffect(()=>{if(!r.current)return;const p=new F;p.background=new T(988970),l.current=p;const g=r.current.clientWidth,j=r.current.clientHeight,i=new H(60,g/j,.1,1e3);i.position.set(0,6,10),h.current=i;const x=new q({antialias:!0,powerPreference:"high-performance",stencil:!1,depth:!0});x.setSize(g,j),x.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.current.appendChild(x.domElement),c.current=x;const L=new W(16777215,.8);p.add(L);const S=new $(16777215,.9);S.position.set(5,5,5),p.add(S);const m=new G(i,x.domElement);m.enableDamping=!0,m.dampingFactor=.05,m.autoRotate=!0,m.autoRotateSpeed=2,m.maxPolarAngle=Math.PI/1.8,m.minDistance=3,m.maxDistance=60,s.current=m;const b=new V,y=new U;y.setDecoderPath("/draco-gltf/"),b.setDRACOLoader(y),b.load("/model/modelo-3d-comprimido.glb",a=>{const d=a.scene;d.scale.set(.8,.8,.8),p.add(d),n.current=d;const u=new Y().setFromObject(d),N=u.getCenter(new z),v=u.getSize(new z),D=Math.max(v.x,v.y,v.z),I=i.fov*(Math.PI/180);let E=Math.abs(D/2/Math.tan(I/2));E*=3,i.position.z=E,i.position.x=N.x,i.position.y=N.y+D*.5,i.lookAt(N),m.target.copy(N),m.update()},void 0,a=>{console.error("Error al cargar el modelo 3D:",a)});let R=performance.now();const A=1e3/60,M=a=>{t.current=requestAnimationFrame(M);const d=a-R;d<A||(R=a-d%A,m.update()&&x.render(p,i))};M(performance.now());const P=()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{if(!r.current)return;const a=r.current.clientWidth,d=r.current.clientHeight;Math.abs(i.aspect-a/d)>.01&&(i.aspect=a/d,i.updateProjectionMatrix(),x.setSize(a,d,!1))},150)};return window.addEventListener("resize",P,{passive:!0}),()=>{t.current&&cancelAnimationFrame(t.current),f.current&&clearTimeout(f.current),window.removeEventListener("resize",P),l.current&&l.current.traverse(a=>{a.isMesh&&(a.geometry&&a.geometry.dispose(),a.material&&(Array.isArray(a.material)?a.material:[a.material]).forEach(u=>{u.map&&u.map.dispose(),u.normalMap&&u.normalMap.dispose(),u.roughnessMap&&u.roughnessMap.dispose(),u.metalnessMap&&u.metalnessMap.dispose(),u.dispose()}))}),c.current&&c.current.dispose(),s.current&&s.current.dispose(),r.current&&c.current?.domElement?.parentNode===r.current&&r.current.removeChild(c.current.domElement)}},[]),e.jsxs("div",{className:"model3d-container",children:[e.jsx("div",{ref:r,className:"model3d-viewer"}),e.jsx("div",{className:"model3d-info",children:e.jsx("p",{children:"Usa el mouse para rotar o su pantalla táctil | Scroll para zoom o pellizcar para acercar/alejar"})})]})}function K({puntos:r,onPuntoClick:l}){const[h,c]=o.useState(null),s=n=>({red:"#B81D1D",green:"#006B42",yellow:"#A06000",blue:"#1B4965"})[n]||"#B81D1D",t=n=>{c(n.id),l?.(n)};return e.jsxs("div",{className:"diagram-container",children:[e.jsx("h2",{className:"diagram-title",children:"Conductores de Bagazo"}),e.jsxs("div",{className:"diagram-content",children:[e.jsx("div",{className:"diagram-image-wrapper",children:e.jsx(_,{})}),e.jsxs("div",{className:"diagram-legend",children:[e.jsx("p",{className:"legend-title",children:"Selecciona un conductor para ver los detalles:"}),e.jsx("div",{className:"legend-items",role:"group","aria-label":"Conductores",children:r.map(n=>e.jsx("button",{className:`legend-item ${h===n.id?"active":""}`,style:{backgroundColor:s(n.color)},onClick:()=>t(n),title:n.nombre,"aria-label":`Conductor ${n.nombre}`,"aria-pressed":h===n.id,children:e.jsx("span",{className:"legend-number",children:n.nombre})},n.id))})]})]}),e.jsx("p",{className:"diagram-hint",children:"Haz clic en cualquier conductor para ver la información completa"})]})}function Z({punto:r,onClose:l}){const[h,c]=o.useState(!1),s=t=>({red:"#B81D1D",green:"#006B42",yellow:"#A06000",blue:"#1B4965"})[t]||"#B81D1D";return o.useEffect(()=>{r&&(c(!1),setTimeout(()=>{c(!0)},50))},[r?.id]),r?e.jsxs("div",{className:`info-panel ${h?"animated":""}`,children:[e.jsxs("div",{className:"info-header",children:[e.jsx("div",{className:"punto-badge",style:{backgroundColor:s(r.color)},children:r.nombre}),e.jsx("button",{className:"close-button",onClick:l,title:"Cerrar",children:"✕"})]}),e.jsx("div",{className:"info-content",children:e.jsxs("div",{className:"info-section description-section",children:[e.jsx("h4",{children:"Descripción:"}),e.jsx("p",{className:"info-description",children:r.descripcion}),e.jsx("h4",{children:"Tipo:"}),e.jsx("p",{className:"info-type",children:r.tipo})]})})]}):e.jsx("div",{className:"info-panel",children:e.jsxs("div",{className:"info-empty",children:[e.jsx("h3",{children:"Selecciona un Conductor"}),e.jsx("p",{children:"Haz clic en cualquier conductor (C1 a C12) de la leyenda para ver su descripción."})]})})}function C(){const r=new Date().getFullYear();return e.jsx("footer",{className:"footer",children:e.jsxs("div",{className:"footer-container",children:[e.jsx("div",{className:"footer-content",children:e.jsxs("div",{className:"footer-info",children:[e.jsxs("p",{className:"footer-text",children:["© ",r," Sistema Conductores de Bagazo - IRISA S.A.S."]}),e.jsx("p",{className:"footer-subtitle",children:"Sistema de Monitoreo - Conductores de Bagazo"})]})}),e.jsx("div",{className:"footer-divider"}),e.jsx("div",{className:"footer-credits",children:e.jsxs("p",{className:"footer-credits-text",children:["|",e.jsx("a",{href:"https://www.ingeniorisaralda.com/es/",className:"footer-link",children:" IRISA S.A.S "})," |",e.jsx("a",{href:"#",className:"footer-link",children:" La Virginia "})]})})]})})}const B="http://localhost:5000/api",J=async()=>{try{const r=await fetch(`${B}/puntos`);if(!r.ok)throw new Error("Error al obtener los puntos");return await r.json()}catch(r){throw console.error("Error en obtenerPuntos:",r),r}},Q=async()=>{try{const r=await fetch(`${B.replace("/api","")}/api/health`);if(!r.ok)throw new Error("Backend no disponible");return await r.json()}catch(r){throw console.error("Error al conectar con el backend:",r),r}};function X(){const[r,l]=o.useState([]),[h,c]=o.useState(null),[s,t]=o.useState(!0),[n,f]=o.useState(null);o.useEffect(()=>{(async()=>{try{await Q();const i=await J();l(i),f(null)}catch{f("No se pudo conectar con el backend. Asegúrate de que esté ejecutándose en el puerto 5000.")}finally{t(!1)}})()},[]);const p=j=>{c(j)},g=()=>{c(null)};return s?e.jsxs("div",{className:"app",children:[e.jsx(w,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Cargando datos..."})]})}),e.jsx(C,{})]}):n?e.jsxs("div",{className:"app",children:[e.jsx(w,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"error",children:[e.jsx("h2",{children:"⚠️ Error de Conexión"}),e.jsx("p",{children:n}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Intentar de nuevo"})]})}),e.jsx(C,{})]}):e.jsxs("div",{className:"app",children:[e.jsx(w,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"content-grid",children:[e.jsx("div",{className:"diagram-section",children:r.length>0?e.jsx(K,{puntos:r,onPuntoClick:p}):e.jsx("p",{className:"no-data",children:"No hay datos disponibles"})}),e.jsx("div",{className:"info-section",children:e.jsx(Z,{punto:h,onClose:g})})]})}),e.jsx(C,{})]})}k.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(X,{})}));
